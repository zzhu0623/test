# 分元电磁仿真软件

## 项目简介

分元电磁仿真软件（PEEC Solver）是一款基于分元等效电路方法（Partial Element Equivalent Circuit, PEEC）开发的电磁仿真工具，适用于集成电路、射频器件、超材料、阵列天线等电子元器件的电磁特性仿真与设计分析。

> 发布日期：2025年
> 版本：V1.0

----------

## 1.功能概述

本软件通过以下六个核心模块完成电磁仿真流程：

1.  **初始化** 
– 生成必要的参数库，如高斯积分数据库，为后续计算提供支持。
    
2.  **数据导入**
 – 读取电子器件的物理模型、材料参数和仿真设置等所需信息。
    
3.  **数据预处理** 
– 对物理模型进行拓扑分析，提炼网格连结关系，生成等效电路所需信息。
    
4.  **等效电路提取**
 – 通过计算单元离散积分，生成并输出分元等效电路模型。
    
5.  **电路求解分析**
 – 利用修正节点分析法，求解电路中的未知电压、电流、电荷分布等主要电磁表征。
    
6.  **评估设计表现** 
– 计算端口散射参数（S parameter），阻抗参数（Z parameter），观测点电压电流分布等目标参数。
----------

## 2.使用方法
将通过一个C形谐振器（图1）仿真分析的应用案例，介绍使用方法和特点，以展示本软件的功能。

图1C形谐振器示意图

<img width="1149" height="1062" alt="4" src="https://github.com/user-attachments/assets/92108afc-2712-40d9-945d-427523eb913c" />


### 2.1数据导入
本软件将读入三种输入数据，分别为物理结构网格剖分信息、材料信息和仿真设定。以下是代码的目录结构说明

Sur_PEC/

├── model/          # 模型文件存放目录

├── Output/         # 输出结果目录

├── DIELECTRIC.txt  # 介质参数文件

└── set.txt         # 配置文件

####  2.1.1**model** - 模型文件夹

-   **用途**：存放仿真所需的几何模型和网格文件
    
-   **必须包含的文件**：   

    -   `.msh` 文件：网格文件
    
 - 该网格文件由GMSH生成，本软件支持 GMSH 类型**(Version 2.1-4.7)**的网格剖分数据。
   GMSH 是一款 开源自动化网格剖分工具，被广泛应用于各类有限元分析软件和算法中。其通过将物理模型剖分成大量微小简单结构（如三角形，四面体，六面体等），将三维空间中任意复杂结构转化至包含此类微小结构的网格数据，以用于离散空间未知量，构建系统方程。 
   本软件主要接受三角形剖分方式所产生的数据。通过输入 GMSH 网格剖分数 据绝对路径，读入 GMSH 的网格剖分数据。
   以 GMSH2.2 版本为例，输入文本主要包含
    1. GMSH 文档版本号
    2. 结构包含的节点数量与坐标
    3. 网格剖分信息与构成节点
   
   以下为双极板网格剖分文件内容，用以说明输入网格剖分信息的主要格式（利用 GMSH.exe 生成）。
   
 ***1.版本号***
```
$MeshFormat							
2.2 0 8
$EndMeshFormat
```
***2.节点信息***
```
$Nodes
14
1 0 0 0
2 1 0 0
...
13 0.5 0.5 0
14 0.5 0.5 -1
$EndNodes
```
***3.网格信息***
```
$Elements
10
1 1 2 50 9 9 11
2 1 2 50 10 10 12
...
9 2 2 1 2 6 14 8
10 2 2 1 2 7 8 14
$EndElements
```
***
####  2.1.2 **DIELECTRIC.txt** - 材料信息文档

-   **用途**：定义仿真中使用的介质材料参数
    
-   **说明**：此文件为预设配置，**一般情况下不需要修改**
***    
#### 2.1.3 **set.txt** - 配置文件

-   **用途**：设置仿真的主要参数
    
-   **重要说明**：**此文件需要根据具体仿真需求进行修改**
    
-   **五种仿真参数将被键入，主要需修改的参数包括**：
    
    -   **FS** （仿真起始频率）
        
    -   **FE** （仿真结束频率）
        
    -  **N_FP**（ 求解频点数目）
        
    -   **DIM**（缩放尺寸）
        
    - **ER**  （介电常数）
 ```
FS 		5e8
FE 		5e9
N_FP 	300	
DIM		1e3
ER 		1.0
 ```
 
 如以上演示文档中求解电磁器件频率范围为 0.5G 赫兹至 5G 赫兹，在该范围内平均提取 300 个频点作为计算频率，且该模型定义为毫米尺寸（1m=1000mm），介电常数为1。
 ***
### 2.2 数据预处理
将网格剖分转译为适用于紧凑分元等效电路模型的含有物理信息的模型剖分，以极板电容的电路物理模型为例，具体流程如下：   
***示例：极板电容***

定义点
```
Point(1) = {0, 0, 0, 1};
...
Point(12) = {1, 0.45, 0, 1.0};
```
定义线
```
Line(1) = {3, 4};
...
Line(10) = {10, 12};
```
定义线环
```
Line Loop(1) = {1, 2, 3, 4};
Line Loop(2) = {5, 6, 7, 8};
```
定义面
```
Plane Surface(1) = {1};
Plane Surface(2) = {2};
```
***
***以下这句定义了两条激励线9和10的阻抗为50Ω***

**需要强调的是：为了符合算法的输入格式，要求必须添加激励线，并且线属性定义的是激励线的阻抗。因此，请在对应激励线上定义其物理属性，同时线激励两端必须不能与网格顶点重合，需保证加在网格边界上或者网格内部。**  
```
Physical Line(50) = {9, 10};
```
***
定义面的物理属性这里统一将面属性初始化为1，表示为完美金属导体，后续会继续拓展算法支持异质分析。
```
Physical Surface(1) = {1, 2};
```
### 2.3等效电路提取
如图2所示本软件将根据分元等效电路理论，将模型剖分以及连结网络转化为由分布式电容、电感组成的分元等效电路。

图2模型剖分转译为分元等效电路概念图

<img width="1020" height="333" alt="2" src="https://github.com/user-attachments/assets/56da100f-5a2b-4352-8649-7c579ab2114d" />


本节将通过积分生成两种矩阵，分为电位矩阵（P），电感矩阵（L）。
### 2.4 电路求解分析
本节利用自研代码，在频率域对提取的等效电路使用***修正节点分析法(Modified Nodal Analysis)***进行分析，求解得到电路中的电流、电势、电荷等信息。核心方程如下：

核心方程

<img width="442" height="133" alt="3" src="https://github.com/user-attachments/assets/b4328c20-57eb-4fd8-8d61-177e7fbad914" />


在本例中，共有节点数 ， 支路数 ，在0.5GHz到5GHz间共选300个频率点进行计算，求得以下两类信息：
- 端口电流信息

- 中心频率的电流、电势、电荷信息

### 2.5 评估设计表现
本节对所求结果进行后处理，得到以下三个文档存于`Output`文件夹下：

- **端口散射参数（S-parameter）**：储存于Sur_PEC\Data\Output\map.txt中
```
      求解频率       实部S(1,1)      虚部S(1,1)	   实部S(2,2)      虚部S(2,2)      实部S(1,2)      虚部S(1,2)      实部S(2,1)     虚部S(2,1)
   5.150000e+08,  -1.377483e+01,  3.966179e+01,  -1.859944e-01,  1.296628e+02,  -1.860540e-01,  1.296628e+02,  -1.377483e+01,  3.966371e+01
   5.300000e+08,  -1.354125e+01,  3.818990e+01,  -1.965077e-01,  1.281909e+02,  -1.965707e-01,  1.281909e+02,  -1.354125e+01,  3.819186e+01
   5.450000e+08,  -1.331481e+01,  3.671724e+01,  -2.072800e-01,  1.267182e+02,  -2.073467e-01,  1.267182e+02,  -1.331481e+01,  3.671924e+01
   5.600000e+08,  -1.309512e+01,  3.524374e+01,  -2.183100e-01,  1.252448e+02,  -2.183804e-01,  1.252448e+02,  -1.309512e+01,  3.524579e+01
   ...
```
- **端口阻抗（Impedance）**：储存于Sur_PEC\Data\Output\Z_in.txt中
```
   求解频率          实部Z(1,1)      虚部Z(1,1)	   实部Z(2,2)      虚部Z(2,2)       实部Z(1,2)     虚部Z(1,2)      实部Z(2,1)     虚部Z(2,1)
   5.150000e+08,  0.000000e+00,  -1.355504e+02,  -0.000000e+00,  2.078720e+02,  -0.000000e+00,  2.078706e+02,  0.000000e+00,  -1.355489e+02
   5.300000e+08,  0.000000e+00,  -1.288976e+02,  -0.000000e+00,  2.038118e+02,  -0.000000e+00,  2.038103e+02,  0.000000e+00,  -1.288961e+02
   5.450000e+08,  0.000000e+00,  -1.225001e+02,  -0.000000e+00,  2.000577e+02,  -0.000000e+00,  2.000562e+02,  0.000000e+00,  -1.224985e+02
   5.600000e+08,  0.000000e+00,  -1.163339e+02,  -0.000000e+00,  1.965888e+02,  -0.000000e+00,  1.965872e+02,  0.000000e+00,  -1.163323e+02
   ...
```
- **端口导纳（Admittance）**：储存于Sur_PEC\Data\Output\Y_in.txt中
```
   求解频率         实部Y(1,1)       虚部Y(1,1)	  实部Y(2,2)      虚部Y(2,2)       实部Y(1,2)     虚部Y(1,2)      实部Y(2,1)      虚部Y(2,1)
   5.150000e+08,  0.000000e+00,  -5.457594e-03,  0.000000e+00,  -8.369530e-03,  0.000000e+00,  -8.369473e-03,  0.000000e+00,  -5.457653e-03
   5.300000e+08,  0.000000e+00,  -5.171451e-03,  0.000000e+00,  -8.177151e-03,  0.000000e+00,  -8.177091e-03,  0.000000e+00,  -5.171511e-03
   5.450000e+08,  0.000000e+00,  -4.896669e-03,  0.000000e+00,  -7.996965e-03,  0.000000e+00,  -7.996903e-03,  0.000000e+00,  -4.896731e-03
   5.600000e+08,  0.000000e+00,  -4.632269e-03,  0.000000e+00,  -7.828027e-03,  0.000000e+00,  -7.827964e-03,  0.000000e+00,  -4.632333e-03
   ...
```
***    
## 3.注意事项
1.  确保所有必需的DLL文件位于运行目录。
    
2.  输入网格建议使用GMSH生成，并确保为三角形剖分。
    
3.  材料文件需严格按格式编写，避免解析错误。
    
4.  大型模型仿真时注意内存与计算时间。
### 3.1 编译环境



### 3.2 运行环境要求

-   编译环境：需安装 **Intel MKL 2024.0** 数学库
    
-   运行环境：确保相关DLL文件位于软件根目录
    
-   输入格式支持：GMSH网格文件（.msh）

### 3.3 可视化工具推荐 
网格剖分、观测电流、电压、电荷文档（.msh）推荐使用 **GMSH.exe**打开， GMSH.exe 将直接生成三维可交互图形。

(GMSH 附于根目录下的“可视化工具”文 件夹内）。 端口散射参数，阻抗参数(.dat)推荐使用**EXCEL，Origin**等数据分析工具进 行视图绘制


## 许可证与致谢

本软件为科研与教育用途开发，版权归作者所有。  
欢迎反馈与合作，共同推进国产EDA工具发展。

