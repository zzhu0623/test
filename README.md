
# 准静态自由空间PEEC电磁求解引擎

## 项目简介

准静态自由空间PEEC电磁求解引擎是一款基于分元等效电路方法（Partial Element Equivalent Circuit, PEEC）开发的电磁仿真工具，适用于集成电路、射频器件、超材料、阵列天线等电子元器件的电磁特性仿真与设计分析。

> 发布日期：2025年

> 版本：V1.0

----------

##  1. 功能概述

本软件通过以下六个核心模块完成电磁仿真流程：

1.  **初始化** 
– 生成必要的参数库，如高斯积分数据库，为后续计算提供支持。
    
2.  **数据导入**
 – 读取电子器件的物理模型、材料参数和仿真设置等所需信息。
    
3.  **数据预处理** 
– 对物理模型进行拓扑分析，提炼网格连结关系，生成等效电路所需信息。
    
4.  **等效电路提取**
 – 通过计算单元离散积分，生成并输出分元等效电路模型。
    
5.  **电路求解分析**
 – 利用修正节点分析法，求解电路中的未知电压、电流、电荷分布等主要电磁表征。
    
6.  **评估设计表现** 
– 计算端口散射参数（S parameter），阻抗参数（Z parameter），端口电压电流分布等目标参数。
***
##  2.  模型准备（可选）
本软件需使用后缀为".msh"的网格文件，可以使用**GMSH 2.2版本**生成。  
GMSH 是一款开源有限元网格生成工具，可将复杂几何模型离散化为三角形、四面体等单元，广泛应用于各类仿真计算。本软件目前主要支持基于三角形的网格剖分数据。
使用时，请将生成的网格文件重命名为 **model.msh**，接下来以C形谐振器为例，说明如何生成所需模型文件（基于 GMSH-2.2 ）。
首先先定义物理模型，格式如下：   

***示例：C形谐振器***

定义点
```
Point(1) = {20, 0-20, 1.8, lc};
...
Point(26) = {10.5, 43-20, 1.8 , lc};
```
定义线
```
Line(2) = {1, 6};

...
Line(16) = {7, 6};
Line(23) = {17, 16};
Line(24) = {15, 18};

Line(51) = {13, 23};
...
Line(62) = {20, 22};
```
定义线环
```
Line Loop(63) = {14, 8, 9, 10, 11, 12, -53, 54, 55, 56, -51};
Line Loop(65) = {15, -3, -16, -11};
Line Loop(67) = {2, 3, 4, 5, 6, 7, 57, 60, 61, 62, 59};
```
定义面
```
Plane Surface(64) = {63};
Plane Surface(66) = {65};
Plane Surface(68) = {67};
```
***
**需要强调的是：为了保证本软件正确仿真，必须添加激励线，并通过线属性指定其阻抗。激励线两端需避免与网格顶点重合，应位于网格边界或内部。例如，将编号为23和24的线定义为阻抗120Ω的激励线，对应的GMSH命令如下：**  
```
Physical Line(120) = {24, 23};
```
***
所有面初始属性设置为1，代表完美金属导体，后续算法将扩展至支持异质材料分析。定义示例：
```
Physical Surface(1) = {64, 81, 93, 66, 68, 69};
```

**完成上述设置后，使用GMSH软件生成对应的`.msh`文件。**
***
将物理模型转换为的含有物理信息的网格模型， 以下列出了C形谐振器的网格剖分文件内容，用以说明输入网格剖分信息的主要格式（基于GMSH-2.2）。
   
 ***1.版本号***
```
$MeshFormat							
2.2 0 8
$EndMeshFormat
```
***2.节点信息***
```
$Nodes
1050
1 20 -20 1.8
2 0 -20 1.8
...
1049 18.49999999999983 -16.35000000000062 -1.8
1050 18.50000000000017 16.35000000000063 -1.8
$EndNodes
```
***3.网格信息***
```
$Elements
1634
1 1 2 120 23 17 16
2 1 2 120 24 15 18
...
1632 2 2 1 93 377 1012 1050
1633 2 2 1 93 262 1049 1013
1634 2 2 1 93 378 1050 1014
$EndElements
```
##  3. 使用方法
通过一个C形谐振器（图1）仿真分析的应用案例，介绍使用方法和特点，以展示本软件的功能。
                                                   
<div align="center">
 <img width="1951" height="1002" alt="5" src="https://github.com/user-attachments/assets/3135430b-5170-4661-8fa2-70ae4df0dfa6" />
</div>

<p align="center">图1 C形谐振器示意图</p>  

### 3.1 数据导入
本软件将读入三种输入数据，分别为物理结构网格剖分信息、材料信息和仿真设定。以下是代码的目录结构说明
```
Sur_PEC/

├── Data/        # 数据存放文件 

    ├── model.msh         # 需要仿真的模型文件
    
    ├── Output/         # 输出结果目录

        ├── map.txt     # 端口散射参数

        ├── Z_in.txt     # 端口阻抗

        └── Y_in.txt     # 端口导纳

    ├── DIELECTRIC.txt  # 介质参数文件
    
    └── set.txt         # 配置文件
    
├── libiomp5md.dll      # 动态链接库
    
└── Sur_PEC.exe         # 仿真可执行程序
```

####  3.1.1 **model.msh** - 模型文件

-   **用途**：表明仿真所需的网格文件
    
-   **注意事项**：将需要进行仿真的模型文件重命名为model.msh，并放入Data文件夹下以确保仿真能够正确顺利运行  
***
####  3.1.2 **DIELECTRIC.txt** - 材料信息文档

-   **用途**：定义仿真中使用的介质材料参数
    
-   **说明**：此文件为后续支持异质仿真的预设文件，**当前版本下不需要修改**
***    
#### 3.1.3 **set.txt** - 主要配置文件

-   **用途**：设置仿真的主要参数
    
-   **重要说明**：**此文件需要根据具体仿真需求进行修改**
    
-   **六种仿真参数将被键入，主要需修改的参数包括**：

    -   **Solver_SET**（频域/时域求解，其中0表示频域求解，1表示时域求解）
    
    -   **FS** （仿真起始频率）
        
    -   **FE** （仿真结束频率）
        
    -  **N_FP**（ 求解频点数目）
        
    -   **DIM**（缩放尺寸）
        
    - **ER**  （介电常数）
 ```
Solver_SET    0
FS 		5e8
FE 		5e9
N_FP 	200	
DIM		1e3
ER 		1.0
 ```
 
 如以上演示文档的内容，表示为频域求解，求解电磁器件频率范围为 0.5G 赫兹至 5G 赫兹，在该范围内平均提取 200 个频点作为计算频率，且该模型定义为毫米尺寸（1m=1000mm），介电常数为1。

 
 ***注：该版本下时域求解为demo版，请使用频域求解，并将Solver_SET默认设置为0***
 
 ***

### 3.2 等效电路提取
如图2所示基于分元等效电路理论，软件将模型剖分以及连结网络转化为由分布式电容、电感组成的分元等效电路。
 
<div align="center">
 <img width="1020" height="333" alt="2" src="https://github.com/user-attachments/assets/56da100f-5a2b-4352-8649-7c579ab2114d" />
</div>

<p align="center">图2 模型剖分转译为分元等效电路概念图</p>  

本节将通过积分生成两种矩阵，分为电位矩阵（P），电感矩阵（L）。
### 3.3 电路求解分析
本节利用自研代码，在频率域对提取的等效电路使用修正节点分析法(Modified Nodal Analysis)进行分析，求解得到电路中的电流、电势、电荷等信息。核心方程如下：

<div align="center">
 <img width="442" height="133" alt="3" src="https://github.com/user-attachments/assets/b4328c20-57eb-4fd8-8d61-177e7fbad914" />
</div>

<p align="center">核心方程</p>  

本例在0.5GHz到5GHz间共选200个频率点进行计算，在求解的过程中还会生成一个等效电路文档包含：端口数、端口节点、元件数、等效元件名称、连结节点、耦合强度等信息，内容如下所示。
```
N_PORT 2            端口数                                                端口信息
PO_1      1369     264
PO_2       815    1092        端口节点

N_ELEMENT 6260928
LL_1_1           0         2  8.7224591179E-11                            电感信息
LM_1_2           0         2         0         3 -2.1744683326E-11
LM_1_3           0         2         1        29  8.6677865715E-13
...等效元件名称                连结节点                       元件值
LM_2220_2218        1621      1622      1619      1631 -9.2443493820E-13
LM_2220_2219        1621      1622      1620      1623 -3.8458394158E-11

CC_1_1           1         0  4.2690843441E-14                            电容信息
CC_1_2           1         2 -2.1754451536E-18
...
CC_1631_1632        1631      1632 -3.2329462645E-20
CC_1632_1632        1632         0  3.0259206314E-14
```
### 3.4 评估设计表现
本节对所求结果进行后处理，得到以下三个文档存于`Output`文件夹下：

- **端口散射参数（S-parameter）**：储存于Sur_PEC\Data\Output\map.txt中
```
      求解频率     实部S(1,1)(dB)    虚部S(1,1)	 实部S(2,2)(dB)    虚部S(2,2)    实部S(1,2)(dB)    虚部S(1,2)    实部S(2,1)(dB)   虚部S(2,1)
   5.225000e+08,  -1.482463e+01,  3.962179e+01,  -1.453806e-01,  1.296218e+02,  -1.454241e-01,  1.296218e+02,  -1.482463e+01,  3.962182e+01
   5.450000e+08,  -1.446840e+01,  3.743193e+01,  -1.580369e-01,  1.274319e+02,  -1.580843e-01,  1.274319e+02,  -1.446840e+01,  3.743195e+01
   5.675000e+08,  -1.412683e+01,  3.523903e+01,  -1.712264e-01,  1.252390e+02,  -1.712779e-01,  1.252390e+02,  -1.412683e+01,  3.523901e+01
   ...
```
- **端口阻抗（Impedance）**：储存于Sur_PEC\Data\Output\Z_in.txt中
```
     求解频率       实部Z(1,1)      虚部Z(1,1)	   实部Z(2,2)      虚部Z(2,2)       实部Z(1,2)     虚部Z(1,2)      实部Z(2,1)     虚部Z(2,1)
   5.150000e+08,  0.000000e+00,  -1.355504e+02,  -0.000000e+00,  2.078720e+02,  -0.000000e+00,  2.078706e+02,  0.000000e+00,  -1.355489e+02
   5.300000e+08,  0.000000e+00,  -1.288976e+02,  -0.000000e+00,  2.038118e+02,  -0.000000e+00,  2.038103e+02,  0.000000e+00,  -1.288961e+02
   5.450000e+08,  0.000000e+00,  -1.225001e+02,  -0.000000e+00,  2.000577e+02,  -0.000000e+00,  2.000562e+02,  0.000000e+00,  -1.224985e+02
   5.600000e+08,  0.000000e+00,  -1.163339e+02,  -0.000000e+00,  1.965888e+02,  -0.000000e+00,  1.965872e+02,  0.000000e+00,  -1.163323e+02
   ...
```
- **端口导纳（Admittance）**：储存于Sur_PEC\Data\Output\Y_in.txt中
```
   求解频率         实部Y(1,1)       虚部Y(1,1)	  实部Y(2,2)      虚部Y(2,2)       实部Y(1,2)     虚部Y(1,2)      实部Y(2,1)      虚部Y(2,1)
   5.150000e+08,  0.000000e+00,  -5.457594e-03,  0.000000e+00,  -8.369530e-03,  0.000000e+00,  -8.369473e-03,  0.000000e+00,  -5.457653e-03
   5.300000e+08,  0.000000e+00,  -5.171451e-03,  0.000000e+00,  -8.177151e-03,  0.000000e+00,  -8.177091e-03,  0.000000e+00,  -5.171511e-03
   5.450000e+08,  0.000000e+00,  -4.896669e-03,  0.000000e+00,  -7.996965e-03,  0.000000e+00,  -7.996903e-03,  0.000000e+00,  -4.896731e-03
   5.600000e+08,  0.000000e+00,  -4.632269e-03,  0.000000e+00,  -7.828027e-03,  0.000000e+00,  -7.827964e-03,  0.000000e+00,  -4.632333e-03
   ...
```
***    
## 4. 注意事项

1.  确保所有必需的DLL文件位于运行目录。
    
2. 输入格式仅支持GMSH网格文件（.msh），建议使用GMSH生成，并确保为三角形剖分。
    
3.  材料文件需严格按格式编写，避免解析错误。
    
4.  大型模型仿真时注意内存与计算时间。
    
## 5. 可视化工具推荐 
网格剖分文档（.msh）推荐使用 **GMSH.exe**打开， GMSH.exe 将直接生成三维可交互图形。(GMSH附于文件夹内）。

电流、电压、端口散射参数，阻抗参数(.dat)等参数推荐使用**EXCEL，Origin**等数据分析工具进行视图绘制

## 6. 参考文献

[1] Jiang Y, Wu K L. Quasi-static surface-PEEC modeling of electromagnetic problem with finite dielectrics[J]. IEEE Transactions on Microwave Theory and Techniques, 2018, 67(2): 565-576.

## 许可证与致谢

本软件为科研与教育用途开发，版权归作者所有。  
欢迎反馈与合作，共同推进国产EDA工具发展。

